<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Recruiter Portal ‚Äì Living Brief</title>

    <style>
        :root {
            --bg-top: #eef6ff;
            --bg-mid: #f7faff;
            --bg-low: #ffffff;

            --card-bg: #ffffff;
            --card-border: #e4e8f0;

            --text: #0f172a;
            --text-soft: #475569;
            --text-muted: #94a3b8;

            --primary: #1e40af;
            --primary-light: #dbeafe;
            --primary-dark: #1e3a8a;

            --verified-soft: #dcfce7;
            --verified-text: #166534;

            --shadow-md: 0 10px 25px rgba(30, 41, 59, 0.08);
            --shadow-soft: 0 4px 12px rgba(0,0,0,0.06);

            --radius-lg: 16px;
            --radius-md: 12px;
        }

        body {
            font-family: system-ui, -apple-system, Segoe UI, sans-serif;
            background: linear-gradient(180deg, var(--bg-top) 0%, var(--bg-mid) 40%, var(--bg-low) 100%);
            margin: 0;
            color: var(--text);
        }

        * { box-sizing: border-box; }

        /* ===================== HEADER ===================== */

        header {
            max-width: 1200px;
            margin: 20px auto 10px;
            padding: 14px 24px;
            background: rgba(255,255,255,0.85);
            border-radius: 20px;
            border: 1px solid var(--card-border);
            backdrop-filter: blur(12px);
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--shadow-soft);
        }

        .header-left { display:flex; flex-direction:column; }
        .header-title { font-weight: 700; font-size: 20px; }
        .header-subtitle { font-size: 13px; color: var(--text-muted); margin-top: 3px; }

        .header-right { display:flex; align-items:center; gap:12px; }

        .header-pill {
            background: var(--primary-light);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            display:flex; align-items:center; gap:6px;
            color: var(--primary-dark);
        }

        .avatar {
            width: 38px; height: 38px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6, #1e3a8a);
            color: white;
            font-weight: 700;
            display:flex; align-items:center; justify-content:center;
        }

        /* ===================== PAGE ===================== */

        .page {
            max-width: 1200px;
            margin: 0 auto;
            padding: 10px 20px 60px;
        }

        h1 {
            margin-bottom: 4px;
            font-size: 28px;
            font-weight: 800;
        }

        .page > p {
            margin-bottom: 16px;
            color: var(--text-soft);
            font-size: 15px;
        }

        /* ===================== TOOLBAR ===================== */

        .toolbar {
            display:flex;
            gap:10px;
            margin-bottom:14px;
            flex-wrap:wrap;
        }

        .search-input {
            flex:1;
            min-width:240px;
            padding:10px 16px;
            border-radius:12px;
            border:1px solid var(--card-border);
            background:white;
            font-size:14px;
        }

        .select {
            padding:10px 14px;
            border-radius:12px;
            border:1px solid var(--card-border);
            background:white;
            font-size:14px;
        }

        .toolbar-btn {
            padding:10px 14px;
            border-radius:12px;
            border:1px solid var(--card-border);
            background:white;
            cursor:pointer;
            font-size:14px;
        }

        /* ===================== FILTER DRAWER ===================== */

        #filter-drawer {
            display:none;
            padding:14px;
            background:white;
            border-radius:14px;
            border:1px solid var(--card-border);
            box-shadow:var(--shadow-soft);
            margin-bottom:12px;
        }

        /* ===================== STUDENT GRID ===================== */

        .grid {
            display:grid;
            grid-template-columns:repeat(auto-fill, minmax(260px, 1fr));
            gap:20px;
            margin-top:10px;
        }

        .card {
            background:white;
            border:1px solid var(--card-border);
            border-radius:var(--radius-lg);
            padding:18px;
            box-shadow:var(--shadow-md);
            display:flex;
            flex-direction:column;
            transition:0.2s ease;
        }

        .card:hover {
            transform:translateY(-3px);
            box-shadow:0 12px 24px rgba(0,0,0,0.12);
        }

        .student-header {
            display:flex;
            align-items:center;
            gap:12px;
        }

        .student-avatar {
            width:48px; height:48px;
            border-radius:50%;
            background:linear-gradient(135deg, #1e3a8a, #3b82f6);
            color:white;
            font-weight:700;
            font-size:15px;
            display:flex; align-items:center; justify-content:center;
        }

        .student-name { font-weight:700; font-size:16px; }
        .student-meta { font-size:13px; color:var(--text-soft); }

        .badge-row {
            display:flex;
            gap:6px;
            margin:10px 0;
            flex-wrap:wrap;
        }

        .badge {
            padding:4px 10px;
            border-radius:20px;
            font-size:11px;
            font-weight:600;
            white-space:nowrap;
        }

        .badge-verified { background:var(--verified-soft); color:var(--verified-text); }
        .badge-domain { background:var(--primary-light); color:var(--primary-dark); }
        .badge-school { background:#e0f2fe; color:#0369a1; }

        .card-metrics {
            margin-top:8px;
            font-size:13px;
            color:var(--text-soft);
            min-height:60px;
        }

        .btn {
            margin-top:auto;
            padding:12px 0;
            border-radius:12px;
            background:linear-gradient(90deg, var(--primary-dark), var(--primary));
            color:white;
            font-size:14px;
            font-weight:600;
            border:none;
            cursor:pointer;
        }

        .btn:hover { filter:brightness(1.05); }

        /* ===================== PROFILE PANEL (SPA, NO SCROLL) ===================== */

        #profile-panel {
            display:none;
            background:white;
            border:1px solid var(--card-border);
            border-radius:20px;
            padding:24px;
            box-shadow:var(--shadow-md);
            margin-top:20px;
        }

        #back-btn {
            background:none;
            border:none;
            color:var(--primary-dark);
            font-size:14px;
            cursor:pointer;
            margin-bottom:10px;
        }

        /* ===================== COPILOT (AI ASSISTANT) ===================== */

        .copilot-toggle {
            position:fixed;
            bottom:20px;
            right:20px;
            padding:10px 14px;
            border-radius:999px;
            border:none;
            background:linear-gradient(90deg,#1e3a8a,#2563eb);
            color:white;
            font-weight:600;
            font-size:14px;
            box-shadow:0 10px 25px rgba(15,23,42,0.3);
            cursor:pointer;
            z-index:50;
            display:flex;
            align-items:center;
            gap:6px;
        }

        #copilot-panel {
            position:fixed;
            bottom:80px;
            right:20px;
            width:340px;
            max-height:480px;
            background:white;
            border-radius:18px;
            box-shadow:0 18px 50px rgba(15,23,42,0.45);
            border:1px solid var(--card-border);
            display:none;
            flex-direction:column;
            overflow:hidden;
            z-index:60;
        }

        .copilot-header {
            padding:10px 14px;
            border-bottom:1px solid var(--card-border);
            display:flex;
            justify-content:space-between;
            align-items:center;
            background:linear-gradient(90deg,#e0f2fe,#e0e7ff);
        }

        .copilot-body {
            padding:10px;
            flex:1;
            overflow-y:auto;
            font-size:13px;
        }

        .copilot-footer {
            border-top:1px solid var(--card-border);
            padding:8px;
            display:flex;
            gap:6px;
        }

        .copilot-input {
            flex:1;
            padding:8px;
            border-radius:10px;
            border:1px solid var(--card-border);
            font-size:13px;
        }

        .copilot-send {
            padding:8px 10px;
            border-radius:10px;
            border:none;
            background:var(--primary-dark);
            color:white;
            font-size:13px;
            cursor:pointer;
        }

        .msg {
            margin-bottom:8px;
            padding:8px 10px;
            border-radius:10px;
            max-width:90%;
        }

        .msg.user {
            margin-left:auto;
            background:#e0f2fe;
            color:#0f172a;
        }

        .msg.bot {
            margin-right:auto;
            background:#f1f5f9;
            color:#0f172a;
        }

        .copilot-suggestion-row {
            display:flex;
            flex-wrap:wrap;
            gap:6px;
            padding:6px 10px 4px;
        }

        .copilot-chip {
            font-size:11px;
            padding:4px 8px;
            border-radius:999px;
            border:1px solid #d1d5db;
            background:#f9fafb;
            cursor:pointer;
        }

        @media(max-width:640px){
            #copilot-panel{
                right:10px;
                left:10px;
                width:auto;
            }
            .copilot-toggle{
                right:10px;
                bottom:10px;
            }
        }

    </style>
</head>
<body>

<header>
    <div class="header-left">
        <div class="header-title">Recruiter Portal</div>
        <div class="header-subtitle" id="header-subtitle">Browse verified student advocates</div>
    </div>
    <div class="header-right">
        <div class="header-pill">‚öñÔ∏è <span id="header-count">0 candidates</span></div>
        <div class="avatar">AJ</div>
    </div>
</header>

<main class="page">
    <h1>Discover Verified Law Students</h1>
    <p>Search, filter, and shortlist candidates based on real case performance.</p>

    <!-- Toolbar -->
    <div class="toolbar">
        <input type="text" id="search-input" class="search-input" placeholder="Search by name, school, or specialization‚Ä¶"/>
        <select id="sort-select" class="select">
            <option value="name">Sort: Name A‚ÄìZ</option>
            <option value="rating">Sort: Best Rating</option>
            <option value="cases">Sort: Most Cases</option>
            <option value="completion">Sort: Highest Completion</option>
        </select>
        <button id="filter-toggle" class="toolbar-btn">Filters</button>
    </div>

    <!-- Filters -->
    <div id="filter-drawer">
        <label>
            <input type="checkbox" id="filter-verified"> Verified only
        </label>
        <select id="filter-domain" class="select" style="margin-left:14px;">
            <option value="all">All domains</option>
        </select>
        <select id="filter-school" class="select" style="margin-left:14px;">
            <option value="all">All schools</option>
        </select>
    </div>

    <!-- Grid -->
    <div id="student-grid" class="grid"></div>

    <div style="text-align:center; margin-top:20px;">
        <button id="load-more-btn" class="toolbar-btn" style="display:none;">Load more</button>
    </div>

    <!-- Profile Panel (SPA, no scroll) -->
    <div id="profile-panel">
        <button id="back-btn">‚Üê Back to results</button>
        <h2 id="profile-name"></h2>
        <p id="profile-meta" style="color:var(--text-soft); margin-bottom:8px;"></p>
        <p id="profile-details"></p>
        <div id="profile-cases"></div>
    </div>
</main>

<!-- Copilot Toggle -->
<button class="copilot-toggle" id="copilot-toggle">ü§ñ Copilot</button>

<!-- Copilot Panel -->
<div id="copilot-panel">
    <div class="copilot-header">
        <div>
            <strong>Recruiter Copilot</strong>
            <div style="font-size:11px; color:#475569;">Ask about candidates & roles</div>
        </div>
        <button id="copilot-close" style="border:none;background:none;font-size:16px;cursor:pointer;">‚úï</button>
    </div>
    <div class="copilot-body" id="copilot-body">
        <div class="msg bot">
            Hi! I can help you:
            <ul style="margin:6px 0 0 16px; padding:0;">
                <li>Summarize a student's profile</li>
                <li>Find best candidates for a role</li>
                <li>Compare two students</li>
            </ul>
        </div>
    </div>
    <div class="copilot-suggestion-row">
        <div class="copilot-chip" data-q="Recommend top students for Corporate M&A.">Top for Corporate M&A</div>
        <div class="copilot-chip" data-q="Summarize Nina Patel as a candidate.">Summarize Nina</div>
        <div class="copilot-chip" data-q="Compare Arjun Singh and Riya Kapoor.">Compare Arjun & Riya</div>
    </div>
    <div class="copilot-footer">
        <input id="copilot-input" class="copilot-input" placeholder="Ask anything about students‚Ä¶"/>
        <button id="copilot-send" class="copilot-send">Send</button>
    </div>
</div>

<script>
    let students = [];

    const headerCountEl = document.getElementById("header-count");
    const filterDomain = document.getElementById("filter-domain");
    const filterSchool = document.getElementById("filter-school");
    const grid = document.getElementById("student-grid");
    const loadMoreBtn = document.getElementById("load-more-btn");
    const toolbarEl = document.querySelector(".toolbar");

    let searchTerm = "";
    let sortBy = "name";
    let showVerified = false;
    let limit = 12;

    async function loadStudents() {
        try {
            const res = await fetch("../students.json");
            const data = await res.json();
            students = data.students || [];
            headerCountEl.textContent = `${students.length} candidates`;
            setupFilters();
            renderGrid();
        } catch (err) {
            console.error("Failed to load students.json", err);
            headerCountEl.textContent = "0 candidates";
            grid.innerHTML = `<div style="grid-column:1/-1;padding:20px;background:#fee2e2;border-radius:12px;border:1px solid #fecaca;color:#991b1b;font-size:14px;">Could not load candidates. Please refresh or contact admin.</div>`;
        }
    }

    function setupFilters() {
        // clear old options (keep "all")
        while (filterDomain.options.length > 1) filterDomain.remove(1);
        while (filterSchool.options.length > 1) filterSchool.remove(1);

        [...new Set(students.flatMap(s => s.specializations || []))].sort().forEach(sp => {
            const o = document.createElement("option");
            o.value = sp;
            o.textContent = sp;
            filterDomain.appendChild(o);
        });

        [...new Set(students.map(s => s.school))].sort().forEach(sc => {
            const o = document.createElement("option");
            o.value = sc;
            o.textContent = sc;
            filterSchool.appendChild(o);
        });
    }

    function applyFilters() {
        let res = [...students];

        if (searchTerm.trim()) {
            const t = searchTerm.toLowerCase();
            res = res.filter(s =>
                (s.name || "").toLowerCase().includes(t) ||
                (s.school || "").toLowerCase().includes(t) ||
                (s.specializations || []).some(sp => sp.toLowerCase().includes(t))
            );
        }

        if (showVerified) res = res.filter(s => s.verified);

        if (filterDomain.value !== "all") {
            res = res.filter(s => (s.specializations || []).includes(filterDomain.value));
        }
        if (filterSchool.value !== "all") {
            res = res.filter(s => s.school === filterSchool.value);
        }

        res.sort((a,b) => {
            if (sortBy === "rating") return (b.rating || 0) - (a.rating || 0);
            if (sortBy === "cases") return (b.casesCount || 0) - (a.casesCount || 0);
            if (sortBy === "completion") return (b.completion || 0) - (a.completion || 0);
            return (a.name || "").localeCompare(b.name || "");
        });

        return res;
    }

    function renderGrid() {
        const list = applyFilters();
        grid.innerHTML = "";

        const visible = list.slice(0, limit);
        visible.forEach(s => {
            const card = document.createElement("div");
            card.className = "card";

            const initials = s.initials || (s.name ? s.name.split(" ").map(p=>p[0]).join("").slice(0,2) : "?");
            const completion = s.completion != null ? s.completion : Math.round(((s.solvedCases || 0) / (s.totalAttempts || (s.solvedCases || 1))) * 100);
            const casesCount = s.casesCount != null ? s.casesCount : (s.solvedCases || 0);
            const rating = s.rating != null ? s.rating : 0;

            const firstSpec = (s.specializations && s.specializations[0]) || "Legal Aid";
            card.innerHTML = `
                <div class="student-header">
                    <div class="student-avatar">${initials}</div>
                    <div>
                        <div class="student-name">${s.name}</div>
                        <div class="student-meta">${s.school || ""} ‚Ä¢ ${s.year || ""}</div>
                    </div>
                </div>
                <div class="badge-row">
                    ${s.verified ? '<span class="badge badge-verified">VERIFIED</span>' : ""}
                    <span class="badge badge-domain">${firstSpec}</span>
                    ${s.school ? `<span class="badge badge-school">${s.school}</span>` : ""}
                </div>
                <div class="card-metrics">
                    <div><b>Completion:</b> ${completion}%</div>
                    <div><b>Cases:</b> ${casesCount}</div>
                    <div><b>Rating:</b> ${rating.toFixed ? rating.toFixed(1) : rating} / 5</div>
                </div>
                <button class="btn" onclick="goToProfile('${s.id}')">View Profile</button>
            `;
            grid.appendChild(card);
        });

        loadMoreBtn.style.display = list.length > limit ? "inline-block" : "none";
    }

    function goToProfile(id) {
        // profile.html reads ?id=student-XXX and uses students.json
        window.location.href = `../student/profile.html?id=${encodeURIComponent(id)}`;
    }

    // Toolbar events
    document.getElementById("search-input").oninput = e => {
        searchTerm = e.target.value.toLowerCase();
        limit = 12;
        renderGrid();
    };
    document.getElementById("sort-select").onchange = e => {
        sortBy = e.target.value;
        renderGrid();
    };
    document.getElementById("filter-toggle").onclick = () => {
        const fd = document.getElementById("filter-drawer");
        fd.style.display = fd.style.display === "none" ? "block" : "none";
    };
    document.getElementById("filter-verified").onchange = e => {
        showVerified = e.target.checked;
        renderGrid();
    };
    filterDomain.onchange = renderGrid;
    filterSchool.onchange = renderGrid;

    loadMoreBtn.onclick = () => {
        limit += 12;
        renderGrid();
    };

    /* ========= Copilot logic (unchanged) ========= */
    const copilotToggle = document.getElementById("copilot-toggle");
    const copilotPanel = document.getElementById("copilot-panel");
    const copilotClose = document.getElementById("copilot-close");
    const copilotBody = document.getElementById("copilot-body");
    const copilotInput = document.getElementById("copilot-input");
    const copilotSend = document.getElementById("copilot-send");

    copilotToggle.onclick = () => {
        copilotPanel.style.display = copilotPanel.style.display === "flex" ? "none" : "flex";
    };
    copilotClose.onclick = () => copilotPanel.style.display = "none";

    document.querySelectorAll(".copilot-chip").forEach(chip => {
        chip.addEventListener("click", () => {
            copilotInput.value = chip.dataset.q;
            handleCopilotQuery();
        });
    });

    copilotSend.onclick = handleCopilotQuery;
    copilotInput.addEventListener("keydown", e => {
        if (e.key === "Enter") handleCopilotQuery();
    });

    function appendMessage(text, from="bot") {
        const div=document.createElement("div");
        div.className = "msg " + from;
        div.textContent = text;
        copilotBody.appendChild(div);
        copilotBody.scrollTop = copilotBody.scrollHeight;
    }

    function handleCopilotQuery() {
        const q = copilotInput.value.trim();
        if (!q) return;
        appendMessage(q, "user");
        copilotInput.value = "";
        const answer = localCopilotAnswer(q);
        appendMessage(answer, "bot");
    }

    function localCopilotAnswer(q) {
        const text = q.toLowerCase();

        const maybeName = students.find(s =>
            (s.name || "").toLowerCase().includes(text)
        );
        if (text.includes("summarize") || text.includes("profile")) {
            if (maybeName) {
                const s = maybeName;
                const completion = s.completion ?? Math.round(((s.solvedCases || 0) / (s.totalAttempts || (s.solvedCases || 1))) * 100);
                const casesCount = s.casesCount ?? (s.solvedCases || 0);
                return `${s.name} (${s.school}, ${s.year}) specialises in ${(s.specializations || []).join(", ") || "public-interest matters"}.
Completion rate: ${completion}%. Cases handled: ${casesCount}. Rating: ${(s.rating || 0).toFixed(1)}/5.
They are a strong fit for matters involving ${(s.specializations || ["their primary domain"]).join(", ")}.`;
            }
        }

        // super simple recommend: top by rating
        if (text.includes("recommend") || text.includes("best") || text.includes("top")) {
            let pool = [...students];
            pool = pool.sort((a,b) => (b.rating || 0) - (a.rating || 0)).slice(0,4);
            if (!pool.length) return "I don‚Äôt have candidates loaded yet. Refresh the page.";
            const lines = pool.map(s => `‚Ä¢ ${s.name} ‚Äì ${(s.specializations || []).join(", ") || "Legal Aid"}, rating ${(s.rating || 0).toFixed(1)}/5, ${s.casesCount ?? s.solvedCases ?? 0} cases`);
            return "Here are strong candidates based on rating:\n\n" + lines.join("\n");
        }

        return "I‚Äôve checked the current candidate pool. Try asking things like:\n‚Ä¢ ‚ÄúSummarize Sarah Rodriguez as a candidate.‚Äù\n‚Ä¢ ‚ÄúRecommend top students for tenancy and labour.‚Äù";
    }

    // kick things off
    loadStudents();
</script>
</body>
</html>
